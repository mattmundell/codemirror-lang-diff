# Context

diff --git x y
   this is context

==>

Source(
    Command,
    Context,
)

# Context contains the word diff

diff --git x y
   this is diff context

==>

Source(
    Command,
    Context,
)

# Addition

diff --git x y
+cramped
+ space

==>

Source(
    Command,
    Addition,
    Addition,
)

# Addition with diff and +

diff --git x y
+cramped with diff
+ space + the end

==>

Source(
    Command,
    Addition,
    Addition,
)

# Space in file name

diff --git a/space b b/space b

==>

Source(
    Command,
)

# New file

diff --git a/x b/y
+++ file name with spaces/dir with spaces

==>

Source(
    Command,
    NewFile(Filename),
)

# Location

diff --git a/x b/y
@@ -1,4 +1,4 @@

==>

Source(
    Command,
    Location(Linerange, Linerange),
)

# Single-file small change

diff --git a/grammar.js b/grammar.js
index dc36969..f37fde0 100644
--- a/grammar.js
+++ b/grammar.js
@@ -6,6 +6,8 @@ module.exports = grammar({
   extras: ($) => [],
 
   rules: {
-    source: ($) => "hello",
+    source: ($) => repeat($._line),
+
+    _line: ($) => choice(),
   },
 });

==>

Source(
    Command,
    Index(Commit,Commit,Mode),
    OldFile(Filename),
    NewFile(Filename),
    Location(Linerange,Linerange),
    Context,
    Context,
    Context,
    Deletion,
    Addition,
    Addition,
    Addition,
    Context,
    Context
)

# New empty file

diff --git a/tmp.txt b/tmp.txt
new file mode 100644
index 0000000..e69de29

==>

Source(
    Command,
    FileChange(FileNew(Mode)),
    Index(Commit,Commit)
)

# Deleted empty file

diff --git a/tmp.txt b/tmp.txt
deleted file mode 100644
index e69de29..0000000

==>

Source(
    Command,
    FileChange(FileDeleted(Mode)),
    Index(Commit,Commit)
)

# File rename

diff --git a/tmp.txt b/tmp.md
similarity index 100%
rename from tmp.txt
rename to tmp.md

==> 

Source(
    Command,
    Similarity,
    FileChange(FileRenamedFrom(Filename)),
    FileChange(FileRenamedTo(Filename)),
)

# Location with no context

@@ -0,0 +1 @@

==>

Source(
    Location(Linerange,Linerange)
)

# No newline at end of file

index 0000000..ee9808d
--- /dev/null
+++ b/tmp.txt
@@ -0,0 +1 @@
+aaa
\ No newline at end of file

==>

Source(
    Index(Commit,Commit),
    OldFile(Filename),
    NewFile(Filename),
    Location(Linerange,Linerange),
    Addition
)

# Just a file declaration and no newline

--- /dev/null

==>

Source(OldFile(Filename))

# location tokens in diff

diff --git a/runtime/queries/elixir/highlights.scm b/runtime/queries/elixir/highlights.scm
index 76fd2af..308ff34 100644
--- a/runtime/queries/elixir/highlights.scm
+++ b/runtime/queries/elixir/highlights.scm
@@ -125,7 +125,8 @@
 (sigil @@ -125,7 +125,8 @@
   (sigil_name) @__name__
   quoted_start: _ @string.special
-  quoted_end: _ @string.special) @string.special
+  quoted_end: _ @string.special
+  (#not-eq? @__name__ "H")) @string.special
 
 ; Calls @@ -125,7 +125,8 @@
 
diff --git a/runtime/queries/elixir/injections.scm b/runtime/queries/elixir/injections.scm
index 321c90a..b4a5cba 100644
--- a/runtime/queries/elixir/injections.scm
+++ b/runtime/queries/elixir/injections.scm
@@ -1,2 +1,8 @@
 ((comment) @injection.content
  (#set! injection.language "comment"))
+
+((sigil
+  (sigil_name) @_sigil_name
+  (quoted_content) @injection.content)
+ (#eq? @_sigil_name "H")
+ (#set! injection.language "heex"))

==>

Source(
    Command,
    Index(Commit,Commit,Mode),
    OldFile(Filename),
    NewFile(Filename),
    Location(Linerange,Linerange),
    Context,
    Context,
    Context,
    Deletion,
    Addition,
    Addition,
    Context,
    Context,
    Context,
    Command,
    Index(Commit,Commit,Mode),
    OldFile(Filename),
    NewFile(Filename),
    Location(Linerange,Linerange),
    Context,
    Context,
    Addition,
    Addition,
    Addition,
    Addition,
    Addition,
    Addition
)

# leading text

From xxx Mon Sep 17 00:00:00 2001
From: Jo Example <jo@example.org>
Date: Mon, 8 Jan 2024 16:16:33 +0200
Subject: [PATCH] Move variables to where they are used

---
 src/gmp.c | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/src/gmp.c b/src/gmp.c

==>

Source(
    Command
)
